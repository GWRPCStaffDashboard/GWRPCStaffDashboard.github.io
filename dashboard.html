<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Staff Dashboard</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>

  <div class="dashboard">
    <h1>GWRPC Staff Dashboard</h1>
    <p id="welcomeText">Loading user...</p>

    <button id="logoutBtn">Logout</button>

    <div class="cards">
      <a href="infractions.html" class="card" id="infractionsCard">
        Infractions
      </a>

      <a href="promotions.html" class="card" id="promotionsCard">
        Promotions
      </a>

      <a href="staff.html" class="card" id="staffCard">
        Staff Management
      </a>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <!-- Firebase init -->
  <script>
    const firebaseConfig = {
    apiKey: "AIzaSyBcaomJMgYpnResuWiYk_ZpyQdvNSUfb1Y",
    authDomain: "gwrpc-staff-dashboard.firebaseapp.com",
    projectId: "gwrpc-staff-dashboard",
    storageBucket: "gwrpc-staff-dashboard.firebasestorage.app",
    messagingSenderId: "907153582140",
    appId: "1:907153582140:web:8e881d795740578041bb39"
    };

    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.firestore();
  </script>

  <!-- Dashboard logic -->
  <script>
    auth.onAuthStateChanged(async (user) => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      const uid = user.uid;
      const doc = await db.collection("users").doc(uid).get();

      if (!doc.exists) {
        alert("No user profile found.");
        auth.signOut();
        return;
      }

      const data = doc.data();
      document.getElementById("welcomeText").textContent =
        `Welcome, ${data.username} (${data.role})`;

      // Permission-based UI
      if (data.accessLevel < 4) {
        document.getElementById("staffCard").style.display = "none";
      }

      if (data.accessLevel < 4) {
        document.getElementById("promotionsCard").style.display = "none";
      }

      if (data.accessLevel < 3) {
        document.getElementById("infractionsCard").style.display = "none";
      }
    });

    document.getElementById("logoutBtn").onclick = () => {
      auth.signOut().then(() => {
        window.location.href = "login.html";
      });
    };
  </script>

</body>
</html>
