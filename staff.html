<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Staff Management | GWRPC</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<div class="app">

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-top">
      <button class="nav-btn" onclick="location.href='dashboard.html'">Dashboard</button>
      <button class="nav-btn" onclick="location.href='infractions.html'">Infractions</button>
      <button class="nav-btn" onclick="location.href='promotions.html'">Promotions</button>
      <button class="nav-btn active">Staff Management</button>
    </div>

    <div class="sidebar-bottom">
      <button class="logout-btn" id="logoutBtn">Logout</button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="content">
    <header class="topbar">
      <div class="site-name">GWRPC Staff Dashboard</div>
      <div class="user-info" id="userInfo">Loading...</div>
    </header>

    <section class="page">
      <h1>Staff Management</h1>

      <table class="staff-table">
        <thead>
          <tr>
            <th>Username</th>
            <th>Role</th>
            <th>Access Level</th>
          </tr>
        </thead>
        <tbody id="staffTable">
          <tr>
            <td colspan="3">Loading staff...</td>
          </tr>
        </tbody>
      </table>

    </section>
  </main>

</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    /* SAME CONFIG AS OTHER PAGES */
  };

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();
</script>

<script>
  auth.onAuthStateChanged(async (user) => {
    if (!user) {
      location.href = "login.html";
      return;
    }

    const uid = user.uid;
    const userDoc = await db.collection("users").doc(uid).get();

    if (!userDoc.exists) {
      alert("User record missing.");
      auth.signOut();
      return;
    }

    const userData = userDoc.data();

    // ACCESS CONTROL â€” Foundership only (adjust level if needed)
    if (userData.accessLevel < 5) {
      alert("Access denied.");
      location.href = "dashboard.html";
      return;
    }

    document.getElementById("userInfo").textContent =
      `${userData.username} - ${userData.role}`;

    loadStaff();
  });

  async function loadStaff() {
    const tbody = document.getElementById("staffTable");
    tbody.innerHTML = "";

    const snapshot = await db.collection("users").get();

    snapshot.forEach(doc => {
      const u = doc.data();

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${u.username}</td>
        <td>${u.role}</td>
        <td>${u.accessLevel}</td>
      `;

      tbody.appendChild(tr);
    });

    if (tbody.children.length === 0) {
      tbody.innerHTML = `<tr><td colspan="3">No staff found.</td></tr>`;
    }
  }

  document.getElementById("logoutBtn").onclick = () => {
    auth.signOut().then(() => {
      location.href = "login.html";
    });
  };
</script>

</body>
</html>
